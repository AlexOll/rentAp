(function(){"use strict";function n(){function n(){function n(n){var t=(Math.random().toString(16)+"000000000").substr(2,8);return n?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return n()+n(!0)+n(!0)+n()}return{createGuid:n}}angular.module("utilities",[]).factory("GuidUtility",n);n.$inject=[]})();class ProfileService{constructor(n){this.$http=n}GetUserMessages(n,t){this.$http.get("/api/profile/usermessages/"+n).then(n=>t(n))}SendMessageInChat(n,t){return this.$http.post("/api/profile",{Id:n.id,UserIdFrom:n.userIdFrom,UserIdTo:n.userIdTo,Body:n.body,CreateDate:n.createDateTime}).then(n=>t(n))}}class AnchorSmoothScrollService{scrollTo(n){function c(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function l(n){for(var i=document.getElementById(n),r=i.offsetTop,t=i;t.offsetParent&&t.offsetParent!==document.body;)t=t.offsetParent,r+=t.offsetTop;return r}var i=c(),t=l(n),o=t>i?t-i:i-t,f,s,h;if(o<100){scrollTo(0,t);return}f=Math.round(o/20);f>=20&&(f=20);var u=Math.round(o/25),r=t>i?i+u:i-u,e=0;if(t>i){for(s=i;s<t;s+=u)setTimeout("window.scrollTo(0, "+r+")",e*f),r+=u,r>t&&(r=t),e++;return}for(h=i;h>t;h-=u)setTimeout("window.scrollTo(0, "+r+")",e*f),r-=u,r<t&&(r=t),e++}}class UserService{constructor(n){this.$http=n}Create(n,t){return this.$http.post("/api/user",{PhoneNumber:n.phonenumber,FirstName:n.firstName,LastName:n.lastName,Password:n.password,Email:n.email}).then(n=>t(n))}Update(n,t){return this.$http.put("/api/user",{Id:n.id,PhoneNumber:n.phonenumber,FirstName:n.firstname,LastName:n.lastname,Password:n.password,Email:n.email,ProfileImageURL:n.profileImageURL}).then(n=>t(n))}}class AuthenticationService{constructor(n,t,i,r){this.$http=n;this.$cookies=t;this.$rootScope=i;this.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.$base64=r}Login(n,t,i){this.$http.post("/api/authentication",{Input:n,Password:t}).then(n=>i(n))}ForgotPass(n,t){this.$http.get("/api/authentication/forgotpassword/"+n).then(n=>t(n))}ResendActivationCode(n,t){this.$http.get("/api/authentication/newactivationcode/"+n).then(n=>t(n))}CheckActivationCode(n,t){this.$http.get("/api/authentication/"+n).then(n=>t(n))}SetCredentials(n){var r=n.email+":"+n.id,i=this.Base64Encode(r),t;this.$rootScope.globals={currentUser:{id:n.id,email:n.email,firstname:n.firstname,phonenumber:n.phonenumber,lastname:n.lastname,name:n.firstname+" "+n.lastname,profileImageURL:n.profileImageURL,authdata:i}};this.$http.defaults.headers.common.Authorization="Basic "+i;t=new Date;t.setDate(t.getDate()+7);this.$cookies.putObject("globals",this.$rootScope.globals,{expires:t})}ClearCredentials(){this.$rootScope.globals={};this.$cookies.remove("globals");this.$http.defaults.headers.common.Authorization="Basic"}Base64Encode(n){var o="",u,t,i="",s,h,f,r="",e=0;do u=n.charCodeAt(e++),t=n.charCodeAt(e++),i=n.charCodeAt(e++),s=u>>2,h=(u&3)<<4|t>>4,f=(t&15)<<2|i>>6,r=i&63,isNaN(t)?f=r=64:isNaN(i)&&(r=64),o=o+this.keyStr.charAt(s)+this.keyStr.charAt(h)+this.keyStr.charAt(f)+this.keyStr.charAt(r),u=t=i="",s=h=f=r="";while(e<n.length);return o}}angular.module("services",["ngRoute","ngCookies"]).service("UserService",UserService).service("AuthenticationService",AuthenticationService).service("AnchorSmoothScrollService",AnchorSmoothScrollService).service("ProfileService",ProfileService);angular.module("myApp.login",["ngRoute","ngMaterial","services","toastr"]).controller("loginCtrl",["$scope","$location","$mdDialog","AuthenticationService","toastr",function(n,t,i,r,u){var f=t.search().activationcode;f&&r.CheckActivationCode(f,function(n){n.data.responseCode===200?(r.SetCredentials(n.data),u.success("Activation code submitted","Have fun!"),t.url("/")):u.error(n.data.message,"Error",{timeOut:"5000",extendedTImeout:"0"})});n.login=function(f){n.dataLoading=!0;r.Login(n.input,n.password,function(e){e.data.responseCode===200?(r.SetCredentials(e.data),u.success("Authentication succeeded","Have fun!"),t.path("/")):(alert=i.alert({title:"You shall not pass",textContent:e.data.message,ok:"Close",clickOutsideToClose:!0,targetEvent:f}),i.show(alert),n.dataLoading=!1)})}}]);angular.module("myApp.forgotpassword",["ngRoute","services","toastr","directives"]).controller("forgotpasswordCtrl",["$scope","$location","AuthenticationService","toastr",function(n,t,i,r){n.forgotPassword=function(){n.dataLoading=!0;i.ForgotPass(n.email,function(n){n.data.responseCode===200?(r.success("Your new Password was sent","Check email!"),t.path("/")):r.error(n.data.message,"Title",{timeOut:"0",extendedTImeout:"0"})})};n.resendActivationCode=function(){n.dataLoading=!0;i.ResendActivationCode(n.email,function(n){n.status===204?(r.success("Your new Activation Code was sent","Check email!"),t.path("/")):r.error("Noooo oo oo ooooo!!!","Title",{timeOut:"0",extendedTImeout:"0"})})}}]);angular.module("myApp.register",["ngRoute","services","toastr","directives"]).controller("registerCtrl",["$scope","UserService","$location","toastr",function(n,t,i,r){n.register=function(){n.dataLoading=!0;t.Create(n.user,function(n){n.data.responseCode===200?(r.success("Check your e-mail for submission","Registration succeeded"),i.path("/")):(alert=$mdDialog.alert({title:"Can't register you're account!",textContent:n.data.message,ok:"Close",clickOutsideToClose:!0,targetEvent:ev}),$mdDialog.show(alert))});n.dataLoading=!1}}]);angular.module("myApp.home",["ngRoute","directives"]).controller("homeCtrl",["$scope",function(n){n.city=null;n.options={country:"ukr",types:"(cities)"};n.serviceType={model:1,availableOptions:[{id:1,name:"Offer sale"},{id:2,name:"Rental offer"},{id:3,name:"Offer roommate"},{id:4,name:"Sales demand"},{id:5,name:"Demand rental"},{id:6,name:"Demand for roommates"}]};n.propertyType={model:[],availableOptions:[{id:1,name:"Appartment"},{id:2,name:"House"},{id:3,name:"Land"},{id:4,name:"Garage"},{id:5,name:"Office"},{id:6,name:"Commercial space"},{id:7,name:"Other"}]};n.search=function(){var t=angular.element(document.querySelector("#city"))[0];n.placeId=t.attributes.placeid.value;alert("see console log");console.log("placeId - "+n.placeId);console.log("propertyType - "+n.propertyType.model);console.log("serviceType - "+n.serviceType.model)}}]);angular.module("myApp.profile",["ngRoute","ngMaterial","services","toastr","base64","utilities"]).controller("profileCtrl",["$rootScope","$scope","UserService","AuthenticationService","toastr","$timeout","AnchorSmoothScrollService","$base64","ProfileService","GuidUtility",function(n,t,i,r,u,f,e,o,s,h){function c(){f(function(){var n=angular.element(document.querySelector(".chat-history"))[0];n.scrollTop=n.scrollHeight},200)}f(function(){n.isSmallResolution||(n.windowScrollY=0,t.favoritesH=angular.element(document.querySelector("#favorites"))[0].offsetTop,t.editProfileH=angular.element(document.querySelector("#editProfile"))[0].offsetTop,t.watchDogH=angular.element(document.querySelector("#watchDog"))[0].offsetTop);c()},1e3);t.user=angular.copy(n.globals.currentUser);t.userMessages=[{id:"111",body:"Hi to ME",createDateTime:"10:00 AM, Today",isRead:!1,userIdFrom:"1ca88925-5ee3-4278-8808-d1229726af60",userIdTo:t.user.id},{id:"121",body:"Hi to U",createDateTime:"10:10 AM, Today",isRead:!0,userIdFrom:t.user.id,userIdTo:"1ca88925-5ee3-4278-8808-d1229726af60"},{id:"131",body:"Hi to ME",createDateTime:"10:14 AM, Today",isRead:!0,userIdFrom:"1ca88925-5ee3-4278-8808-d1229726af60",userIdTo:t.user.id},{id:"141",body:"Hi to ME",createDateTime:"10:18 AM, Today",isRead:!0,userIdFrom:"1ca88925-5ee3-4278-8808-d1229726af60",userIdTo:t.user.id},{id:"151",body:"Hi!5",createDateTime:"today",isRead:!1,userIdFrom:t.user.id,userIdTo:"1ca88925-5ee3-4278-8808-d1229726af60"},{id:"151",body:"Hi!5",createDateTime:"today",isRead:!1,userIdFrom:t.user.id,userIdTo:"1211111"},{id:"151",body:"Hi!5",createDateTime:"today",isRead:!1,userIdFrom:t.user.id,userIdTo:"1311111"},{id:"151",body:"Hi!5",createDateTime:"today",isRead:!1,userIdFrom:t.user.id,userIdTo:"1411111"},{id:"151",body:"Hi!5",createDateTime:"today",isRead:!1,userIdFrom:t.user.id,userIdTo:"1511111"},{id:"151",body:"Hi!5",createDateTime:"today",isRead:!1,userIdFrom:"1511111",userIdTo:t.user.id}];t.chatUsers=[{id:"1ca88925-5ee3-4278-8808-d1229726af60",name:"John Brown",isOnline:!0,avatar:"../../img/chat_avatars/chat_avatar_01.jpg",lastEntrance:"online"},{id:"1211111",name:"John2",isOnline:!0,avatar:"../../img/chat_avatars/chat_avatar_02.jpg",lastEntrance:"online"},{id:"1311111",name:"John3",isOnline:!1,avatar:"../../img/chat_avatars/chat_avatar_03.jpg",lastEntrance:" left 7 mins ago "},{id:"1411111",name:"John4",isOnline:!1,avatar:"../../img/chat_avatars/chat_avatar_04.jpg",lastEntrance:" left 7 mins ago "},{id:"1511111",name:"John5",isOnline:!1,avatar:"../../img/chat_avatars/chat_avatar_05.jpg",lastEntrance:" left 7 mins ago "}];t.chosenChater=t.chatUsers[0];t.chooseChater=function(i){t.chosenChater=i;f(function(){c();n.isSmallResolution&&e.scrollTo("chat-header",-70)},500)};t.sendMessageInChat=function(){var i=new Date,r=h.createGuid(),n={id:r,body:t.newMessage,createDateTime:i,userIdFrom:t.user.id,userIdTo:t.chosenChater.id};s.SendMessageInChat(n,function(i){i.data.responseCode===200?(t.userMessages.push(n),c(),t.newMessage=null):u.error(i.data.message,"Error",{timeOut:"5000",extendedTImeout:"0"})})};t.updateProfile=function(){t.user.profileImageURL=n.globals.currentUser.profileImageURL;i.Update(t.user,function(i){i.data.responseCode===200?(r.SetCredentials(i.data),n.name=n.globals.currentUser.name,u.success("Your profile has been updated.","Success!"),t.user.password=""):(u.error(i.data.message,"Error",{timeOut:"5000",extendedTImeout:"0"}),t.user.password="")})}}]);angular.module("directives",[]).directive("uniqueField",["$http","$rootScope",function(n,t){var i;return{restrict:"A",require:"ngModel",link:function(r,u,f,e){r.$watch(f.ngModel,function(r){i&&clearTimeout(i);i=setTimeout(function(){if((e.$setValidity("duplicate",!0),r!==t.globals.currentUser.phonenumber)&&r&&!e.$error.pattern){var i="";f.id==="phonenumber"?i="/api/user/phonenumbercheck":f.id==="email"&&(i="/api/user/emailcheck");n.get(i,{params:{value:r}}).then(function(n){n.data?e.$setValidity("duplicate",!1):e.$setValidity("duplicate",!0)})}},500)})}}}]).directive("ngAutocomplete",function(){return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?",placeid:"=placeid"},link:function(n,t,i,r){var u,f=!1,o=function(){u={};n.options&&(f=n.options.watchEnter!==!0?!1:!0,n.options.types?(u.types=[],u.types.push(n.options.types),n.gPlace.setTypes(u.types)):n.gPlace.setTypes([]),n.options.bounds?(u.bounds=n.options.bounds,n.gPlace.setBounds(u.bounds)):n.gPlace.setBounds(null),n.options.country?(u.componentRestrictions={country:n.options.country},n.gPlace.setComponentRestrictions(u.componentRestrictions)):n.gPlace.setComponentRestrictions(null))},e;n.gPlace==undefined&&(n.gPlace=new google.maps.places.Autocomplete(t[0],{}));google.maps.event.addListener(n.gPlace,"place_changed",function(){var u=n.gPlace.getPlace();i.$set("placeid",u.place_id);u!==undefined&&(u.address_components!==undefined?(r.$setValidity("notexists",!1),n.$apply(function(){n.details=u;r.$setViewValue(t.val())})):(r.$setValidity("notexists",!0),f&&e(u)))});e=function(i){var u=new google.maps.places.AutocompleteService;i.name.length>0&&u.getPlacePredictions({input:i.name,offset:i.name.length},function(i){if(i==null||i.length==0)n.$apply(function(){n.details=null});else{var u=new google.maps.places.PlacesService(t[0]);u.getDetails({reference:i[0].reference},function(i,u){u==google.maps.GeocoderStatus.OK&&n.$apply(function(){r.$setViewValue(i.formatted_address);t.val(i.formatted_address);n.details=i;var u=t.on("focusout",function(){t.val(i.formatted_address);t.unbind("focusout")})})})}})};r.$render=function(){var n=r.$viewValue;t.val(n)};n.watchOptions=function(){return n.options};n.$watch(n.watchOptions,function(){o()},!0)}}}).directive("setHeight",function(n){return{link:function(t,i){i.css("height",n.innerHeight*.6+"px")}}}).directive("ngImageCompress",["$q","$rootScope",function(n,t){var i=window.URL||window.webkitURL,e=function(){var t="fileupload-resize-area",n=document.getElementById(t);return n||(n=document.createElement("canvas"),n.id=t,n.style.visibility="hidden",document.body.appendChild(n)),n},r=function(n,t){var o=t.resizeType,c=t.resizeQuality*100||70,s="image/jpeg",u;o!==undefined&&o==="png"&&(s="image/png");var f=t.resizeMaxHeight||300,e=t.resizeMaxWidth||250,i=n.height,r=n.width;r>i?r>e&&(i=Math.round(i*=e/r),r=e):i>f&&(r=Math.round(r*=f/i),i=f);u=document.createElement("canvas");u.width=r;u.height=i;var a=u.getContext("2d").drawImage(n,0,0,r,i),l=u.toDataURL(s,c/100),h=new Image;return h.src=l,h.src},u=function(n,t){var i=new Image;i.onload=function(){t(i)};i.src=n},f=function(t){var i=n.defer(),r=new FileReader;return r.onload=function(n){i.resolve(n.target.result)},r.readAsDataURL(t),i.promise};return{restrict:"A",scope:{resizeMaxHeight:"@?",resizeMaxWidth:"@?",resizeQuality:"@?",resizeType:"@?"},link:function(n,e,o){var h=function(t,i){u(t.url,function(u){var f=r(u,n);t.compressed={dataURL:f,type:f.match(/:(.+\/.+);/)[1]};i(t)})},s=function(i){n.$apply(function(){o.multiple||(t.globals.currentUser.profileImageURL=i.compressed.dataURL)})};e.bind("change",function(t){var u,r,e;for(o.multiple&&(n.image=[]),u=t.target.files,r=0;r<u.length;r++)e={file:u[r],url:i.createObjectURL(u[r])},f(u[r]).then(function(n){e.dataURL=n}),n.resizeMaxHeight||n.resizeMaxWidth?h(e,function(n){s(n)}):s(e)})}}}]);