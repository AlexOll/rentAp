(function(){"use strict";angular.module("utilities",[])})(),function(){"use strict";function n(){function n(){function n(n){var t=(Math.random().toString(16)+"000000000").substr(2,8);return n?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return n()+n(!0)+n(!0)+n()}return{createGuid:n}}angular.module("utilities").factory("GuidUtility",n);n.$inject=[]}(),function(){"use strict";function n(n){function t(){n.hubConnection=new signalR.HubConnection("/mainHub");n.hubConnection.start().then(function(){n.hubConnection.invoke("InitConnection",n.globals.currentUser.id)})}function i(t){n.hubConnection.on("messageSent",n=>t(n))}function r(t){n.hubConnection.on("onlineStatusUpdated",n=>t(n))}return{initConnection:t,messageSent:i,onlineStatusUpdated:r}}angular.module("utilities").factory("HubUtility",n);n.$inject=["$rootScope"]}(),function(){"use strict";angular.module("directives",[])}(),function(){"use strict";angular.module("directives").directive("ngAutocomplete",function(){return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?",placeid:"=placeid",lat:"=lat",long:"=long"},link:function(n,t,i,r){var u,f=!1,o=function(){u={};n.options&&(f=n.options.watchEnter!==!0?!1:!0,n.options.types?(u.types=[],u.types.push(n.options.types),n.gPlace.setTypes(u.types)):n.gPlace.setTypes([]),n.options.bounds?(u.bounds=n.options.bounds,n.gPlace.setBounds(u.bounds)):n.gPlace.setBounds(null),n.options.country?(u.componentRestrictions={country:n.options.country},n.gPlace.setComponentRestrictions(u.componentRestrictions)):n.gPlace.setComponentRestrictions(null))},e;n.gPlace===undefined&&(n.gPlace=new google.maps.places.Autocomplete(t[0],{}));google.maps.event.addListener(n.gPlace,"place_changed",function(){var u=n.gPlace.getPlace();i.$set("placeid",u.place_id);i.$set("lat",u.geometry.location.lat());i.$set("lng",u.geometry.location.lng());u!==undefined&&(u.address_components!==undefined?(r.$setValidity("notexists",!1),n.$apply(function(){n.details=u;r.$setViewValue(t.val())})):(r.$setValidity("notexists",!0),f&&e(u)))});e=function(i){var u=new google.maps.places.AutocompleteService;i.name.length>0&&u.getPlacePredictions({input:i.name,offset:i.name.length},function(i){if(i===null||i.length===0)n.$apply(function(){n.details=null});else{var u=new google.maps.places.PlacesService(t[0]);u.getDetails({reference:i[0].reference},function(i,u){u===google.maps.GeocoderStatus.OK&&n.$apply(function(){r.$setViewValue(i.formatted_address);t.val(i.formatted_address);n.details=i;var u=t.on("focusout",function(){t.val(i.formatted_address);t.unbind("focusout")})})})}})};r.$render=function(){var n=r.$viewValue;t.val(n)};n.watchOptions=function(){return n.options};n.$watch(n.watchOptions,function(){o()},!0)}}})}(),function(){"use strict";angular.module("directives").directive("ngImageCompress",["$q","$rootScope",function(n,t){var i=window.URL||window.webkitURL,e=function(){var t="fileupload-resize-area",n=document.getElementById(t);return n||(n=document.createElement("canvas"),n.id=t,n.style.visibility="hidden",document.body.appendChild(n)),n},r=function(n,t){var o=t.resizeType,c=t.resizeQuality*100||70,s="image/jpeg",u;o!==undefined&&o==="png"&&(s="image/png");var f=t.resizeMaxHeight||300,e=t.resizeMaxWidth||250,i=n.height,r=n.width;r>i?r>e&&(i=Math.round(i*=e/r),r=e):i>f&&(r=Math.round(r*=f/i),i=f);u=document.createElement("canvas");u.width=r;u.height=i;var a=u.getContext("2d").drawImage(n,0,0,r,i),l=u.toDataURL(s,c/100),h=new Image;return h.src=l,h.src},u=function(n,t){var i=new Image;i.onload=function(){t(i)};i.src=n},f=function(t){var i=n.defer(),r=new FileReader;return r.onload=function(n){i.resolve(n.target.result)},r.readAsDataURL(t),i.promise};return{restrict:"A",scope:{resizeMaxHeight:"@?",resizeMaxWidth:"@?",resizeQuality:"@?",resizeType:"@?"},link:function(n,e,o){var h=function(t,i){u(t.url,function(u){var f=r(u,n);t.compressed={dataURL:f,type:f.match(/:(.+\/.+);/)[1]};i(t)})},s=function(i){n.$apply(function(){o.multiple||(t.globals.currentUser.profileImageURL=i.compressed.dataURL)})};e.bind("change",function(t){var u,r,e;for(o.multiple&&(n.image=[]),u=t.target.files,r=0;r<u.length;r++)e={file:u[r],url:i.createObjectURL(u[r])},f(u[r]).then(function(n){e.dataURL=n}),n.resizeMaxHeight||n.resizeMaxWidth?h(e,function(n){s(n)}):s(e)})}}}])}(),function(){"use strict";angular.module("directives").directive("setHeight",function(n){return{link:function(t,i,r){i.css("height",n.innerHeight*r.setHeight+"px")}}})}(),function(){"use strict";angular.module("directives").directive("uniqueField",["$http","$rootScope",function(n,t){var i;return{restrict:"A",require:"ngModel",link:function(r,u,f,e){r.$watch(f.ngModel,function(r){i&&clearTimeout(i);i=setTimeout(function(){if(e.$setValidity("duplicate",!0),r&&!e.$error.pattern){if(t.globals.currentUser&&r===t.globals.currentUser.phonenumber)return;var i="";f.id==="phonenumber"?i="/api/user/phonenumbercheck":f.id==="email"&&(i="/api/user/emailcheck");n.get(i,{params:{value:r}}).then(function(n){n.data?e.$setValidity("duplicate",!1):e.$setValidity("duplicate",!0)})}},500)})}}}])}();class ProfileService{constructor(n){this.$http=n}GetUserMessages(n,t){this.$http.get("/api/profile/usermessages/"+n).then(n=>t(n))}SendChatMessage(n,t){return this.$http.post("/api/profile",{Id:n.id,UserIdFrom:n.userIdFrom,UserIdTo:n.userIdTo,Body:n.body,CreateDateTime:n.createDateTime}).then(n=>t(n))}UpdateOnlineStatus(n){return this.$http.put("/api/profile/updateonlinestatus/"+n).then()}}class AnchorSmoothScrollService{scrollTo(n){function c(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function l(n){for(var i=document.getElementById(n),r=i.offsetTop,t=i;t.offsetParent&&t.offsetParent!==document.body;)t=t.offsetParent,r+=t.offsetTop;return r}var i=c(),t=l(n),o=t>i?t-i:i-t,f,s,h;if(o<100){scrollTo(0,t);return}f=Math.round(o/20);f>=20&&(f=20);var u=Math.round(o/25),r=t>i?i+u:i-u,e=0;if(t>i){for(s=i;s<t;s+=u)setTimeout("window.scrollTo(0, "+r+")",e*f),r+=u,r>t&&(r=t),e++;return}for(h=i;h>t;h-=u)setTimeout("window.scrollTo(0, "+r+")",e*f),r-=u,r<t&&(r=t),e++}}class UserService{constructor(n){this.$http=n}Create(n,t){return this.$http.post("/api/user",{PhoneNumber:n.phonenumber,FirstName:n.firstName,LastName:n.lastName,Password:n.password,Email:n.email}).then(n=>t(n))}Update(n,t){return this.$http.post("/api/user/update",{Id:n.id,PhoneNumber:n.phonenumber,FirstName:n.firstname,LastName:n.lastname,Password:n.password,Email:n.email,ProfileImageURL:n.profileImageURL}).then(n=>t(n))}}class AuthenticationService{constructor(n,t,i,r){this.$http=n;this.$cookies=t;this.$rootScope=i;this.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.$base64=r}Login(n,t,i){this.$http.post("/api/authentication",{Input:n,Password:t}).then(n=>i(n))}ForgotPass(n,t){this.$http.get("/api/authentication/forgotpassword/"+n).then(n=>t(n))}ResendActivationCode(n,t){this.$http.get("/api/authentication/newactivationcode/"+n).then(n=>t(n))}CheckActivationCode(n,t){this.$http.get("/api/authentication/"+n).then(n=>t(n))}SetCredentials(n){var r=n.email+":"+n.id,i=this.Base64Encode(r),t;this.$rootScope.globals={currentUser:{id:n.id,email:n.email,firstname:n.firstname,phonenumber:n.phonenumber,lastname:n.lastname,name:n.firstname+" "+n.lastname,profileImageURL:n.profileImageURL,authdata:i}};this.$http.defaults.headers.common.Authorization="Basic "+i;t=new Date;t.setDate(t.getDate()+7);this.$cookies.putObject("globals",this.$rootScope.globals,{expires:t})}ClearCredentials(){this.$rootScope.globals={};this.$cookies.remove("globals");this.$http.defaults.headers.common.Authorization="Basic"}Base64Encode(n){var o="",u,t,i="",s,h,f,r="",e=0;do u=n.charCodeAt(e++),t=n.charCodeAt(e++),i=n.charCodeAt(e++),s=u>>2,h=(u&3)<<4|t>>4,f=(t&15)<<2|i>>6,r=i&63,isNaN(t)?f=r=64:isNaN(i)&&(r=64),o=o+this.keyStr.charAt(s)+this.keyStr.charAt(h)+this.keyStr.charAt(f)+this.keyStr.charAt(r),u=t=i="",s=h=f=r="";while(e<n.length);return o}}angular.module("services",["ngRoute","ngCookies"]).service("UserService",UserService).service("AuthenticationService",AuthenticationService).service("AnchorSmoothScrollService",AnchorSmoothScrollService).service("ProfileService",ProfileService);angular.module("myApp.login",["ngRoute","ngMaterial","services","toastr"]).controller("loginCtrl",["$scope","$location","$mdDialog","AuthenticationService","toastr","HubUtility",function(n,t,i,r,u,f){var e=t.search().activationcode;e&&r.CheckActivationCode(e,function(n){n.data.responseCode===200?(r.SetCredentials(n.data),u.success("Activation code submitted","Have fun!"),t.url("/")):u.error(n.data.message,"Error",{timeOut:"5000",extendedTImeout:"0"})});n.login=function(e){n.dataLoading=!0;r.Login(n.input,n.password,function(o){o.data.responseCode===200?(r.SetCredentials(o.data),f.initConnection(),u.success("Authentication succeeded","Have fun!"),t.path("/")):(alert=i.alert({title:"You shall not pass",textContent:o.data.message,ok:"Close",clickOutsideToClose:!0,targetEvent:e}),i.show(alert),n.dataLoading=!1)})}}]);angular.module("myApp.forgotpassword",["ngRoute","services","toastr","directives"]).controller("forgotpasswordCtrl",["$scope","$location","AuthenticationService","toastr",function(n,t,i,r){n.forgotPassword=function(){n.dataLoading=!0;i.ForgotPass(n.email,function(n){n.data.responseCode===200?(r.success("Your new Password was sent","Check email!"),t.path("/")):r.error(n.data.message,"Title",{timeOut:"0",extendedTImeout:"0"})})};n.resendActivationCode=function(){n.dataLoading=!0;i.ResendActivationCode(n.email,function(n){n.status===204?(r.success("Your new Activation Code was sent","Check email!"),t.path("/")):r.error("Noooo oo oo ooooo!!!","Title",{timeOut:"0",extendedTImeout:"0"})})}}]);angular.module("myApp.register",["ngRoute","services","toastr","directives"]).controller("registerCtrl",["$scope","UserService","$location","toastr",function(n,t,i,r){n.register=function(){n.dataLoading=!0;t.Create(n.user,function(n){n.data.responseCode===200?(r.success("Check your e-mail for submission","Registration succeeded"),i.path("/")):(alert=$mdDialog.alert({title:"Can't register you're account!",textContent:n.data.message,ok:"Close",clickOutsideToClose:!0,targetEvent:ev}),$mdDialog.show(alert))});n.dataLoading=!1}}]);angular.module("myApp.home",["directives"]).controller("homeCtrl",["$scope","$cookies","$location",function(n,t,i){n.city=null;n.options={country:"ukr",types:"(cities)"};n.serviceType={model:1,availableOptions:[{id:1,name:"Offer sale"},{id:2,name:"Rental offer"},{id:3,name:"Offer roommate"},{id:4,name:"Sales demand"},{id:5,name:"Demand rental"},{id:6,name:"Demand for roommates"}]};n.propertyType={model:[],availableOptions:[{id:1,name:"Appartment"},{id:2,name:"House"},{id:3,name:"Land"},{id:4,name:"Garage"},{id:5,name:"Office"},{id:6,name:"Commercial space"},{id:7,name:"Other"}]};n.search=function(){var t=n.placeId;i.path("/search/").search({propertyType:n.propertyType.model,serviceType:n.serviceType.model,city:n.city,lat:n.form.city.$$attr.lat,lng:n.form.city.$$attr.lng})}}]);angular.module("myApp.profile",["ngRoute","ngMaterial","services","toastr","base64","utilities"]).controller("profileCtrl",["$rootScope","$scope","UserService","AuthenticationService","toastr","$timeout","AnchorSmoothScrollService","$base64","ProfileService","GuidUtility","HubUtility",function(n,t,i,r,u,f,e,o,s,h,c){function l(){f(function(){var n=angular.element(document.querySelector(".chat-history"))[0];n&&(n.scrollTop=n.scrollHeight)},200)}t.user=angular.copy(n.globals.currentUser);c.messageSent(function(n){t.userMessages.push(n);t.$apply();l()});c.onlineStatusUpdated(function(n){t.chatUsers.forEach(function(t){t.lastOnlineDateTime=n[t.id.toString()]||t.lastOnlineDateTime});t.$apply()});f(function(){n.isSmallResolution||(n.windowScrollY=0,t.favoritesH=angular.element(document.querySelector("#favorites"))[0].offsetTop,t.editProfileH=angular.element(document.querySelector("#editProfile"))[0].offsetTop,t.watchDogH=angular.element(document.querySelector("#watchDog"))[0].offsetTop)},1e3);s.GetUserMessages(t.user.id,function(n){n.data.responseCode===200?(t.userMessages=n.data.messages,t.chatUsers=n.data.users,t.chosenChater=t.chatUsers[0],l()):u.error(n.data.message,"Error",{timeOut:"5000",extendedTImeout:"0"})});t.chooseChater=function(i){t.chosenChater=i;f(function(){l();n.isSmallResolution&&e.scrollTo("chat-header",-70)},500)};t.sendChatMessage=function(){var i=new Date,r=h.createGuid(),n={id:r,body:t.newMessage,createDateTime:i,userIdFrom:t.user.id,userIdTo:t.chosenChater.id};s.SendChatMessage(n,function(i){i.data.responseCode===200?(t.userMessages.push(n),l(),t.newMessage=null):u.error(i.data.message,"Error",{timeOut:"5000",extendedTImeout:"0"})})};t.getMessageCreateDateTime=function(n){var t=new Date(n),r=new Date,i=(r-t)/6e4;return i<1?"Just sent":i<60?parseInt(i)+" minutes ago":i<1440?t.getHours()+":"+t.getMinutes():t.toLocaleDateString()+" "+t.toLocaleTimeString()};t.getOnlineStatus=function(n){var t=new Date(n),r=new Date,i=(r-t)/6e4;return i<1?"Online":i<60?"Was here "+parseInt(i)+" minutes ago":i<1440?"Last entrance - "+t.getHours()+":"+t.getMinutes():"Last entrance - "+t.toLocaleDateString()+" "+t.toLocaleTimeString()};t.updateProfile=function(){t.dataLoading=!0;t.user.profileImageURL=n.globals.currentUser.profileImageURL;i.Update(t.user,function(i){i.data.responseCode===200?(r.SetCredentials(i.data),n.name=n.globals.currentUser.name,u.success("Your profile has been updated.","Success!"),t.user.password=""):(u.error(i.data.message,"Error",{timeOut:"5000",extendedTImeout:"0"}),t.user.password="")});t.dataLoading=!1}}]);angular.module("myApp.mapSearch",[]).controller("mapSearchCtrl",["$scope","$location",function(n,t){var i;n.options={country:"ukr",types:"(cities)"};n.serviceType={model:1,availableOptions:[{id:1,name:"Offer sale"},{id:2,name:"Rental offer"},{id:3,name:"Offer roommate"},{id:4,name:"Sales demand"},{id:5,name:"Demand rental"},{id:6,name:"Demand for roommates"}]};n.propertyType={model:[],availableOptions:[{id:1,name:"Appartment"},{id:2,name:"House"},{id:3,name:"Land"},{id:4,name:"Garage"},{id:5,name:"Office"},{id:6,name:"Commercial space"},{id:7,name:"Other"}]};i=t.search();console.log(i);n.city=i.city;n.serviceType.model=parseInt(i.serviceType);n.propertyType.model=i.propertyType==null?[]:i.propertyType.map(Number);n.choosePropertyType=function(t){var i=n.propertyType.model.indexOf(t.id);i>=0?n.propertyType.model.splice(i,1):n.propertyType.model.push(t.id);console.log(n.propertyType.model)};$(".dropdown dt").on("click",function(){$(".dropdown dd ul").slideToggle("fast")});$(".dropdown dd ul li").on("click",function(){$(".dropdown dd ul").hide()});$(document).bind("click",function(n){var t=$(n.target);t.parents().hasClass("dropdown")||$(".dropdown dd ul").hide()});var u=new google.maps.Map(document.getElementById("map"),{zoom:14,center:{lat:parseFloat(i.lat),lng:parseFloat(i.lng)}}),r="ABCDEFGHIJKLMNOPQRSTUVWXYZ",f=[{lat:-31.56391,lng:147.154312},{lat:-33.718234,lng:150.363181},{lat:-33.727111,lng:150.371124},{lat:-33.848588,lng:151.209834},{lat:-33.851702,lng:151.216968},{lat:-34.671264,lng:150.863657},{lat:-35.304724,lng:148.662905},{lat:-36.817685,lng:175.699196},{lat:-36.828611,lng:175.790222},{lat:-37.75,lng:145.116667},{lat:-37.759859,lng:145.128708},{lat:-37.765015,lng:145.133858},{lat:-37.770104,lng:145.143299},{lat:-37.7737,lng:145.145187},{lat:-37.774785,lng:145.137978},{lat:-37.819616,lng:144.968119},{lat:-38.330766,lng:144.695692},{lat:-39.927193,lng:175.053218},{lat:-41.330162,lng:174.865694},{lat:-42.734358,lng:147.439506},{lat:-42.734358,lng:147.501315},{lat:-42.735258,lng:147.438},{lat:-43.999792,lng:170.463352}].map(function(n,t){return new google.maps.Marker({position:n,label:r[t%r.length]})}),e=new MarkerClusterer(u,f,{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"})}]);